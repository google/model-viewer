<!--
/* @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <title>&lt;model-viewer&gt; Examples and Documentation</title>
  <meta charset="utf-8">
  <meta name="description" content="&lt;model-viewer&gt; examples and documentation">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link type="text/css" href="../styles/examples.css" rel="stylesheet" />
  <link rel="shortcut icon" type="image/png" href="../assets/favicon.png" />
  <script src="../node_modules/resize-observer-polyfill/dist/ResizeObserver.js"></script>

  <!-- The following libraries and polyfills are recommended to maximize browser support -->

  <!-- ðŸš¨ REQUIRED: Web Components polyfill to support Edge and Firefox < 63 -->
  <script src="../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>

  <!-- ðŸ’ OPTIONAL: Intersection Observer polyfill for better performance in Safari and IE11 -->
  <script src="../node_modules/intersection-observer/intersection-observer.js"></script>

  <!-- ðŸ’ OPTIONAL: Resize Observer polyfill improves resize behavior in non-Chrome browsers -->
  <script src="../node_modules/resize-observer-polyfill/dist/ResizeObserver.js"></script>

  <!-- ðŸ’ OPTIONAL: The :focus-visible polyfill removes the focus ring for some input types -->
  <script src="../node_modules/focus-visible/dist/focus-visible.js" defer></script>

  <style>
    html {
      scroll-behavior: smooth;
    }

    .sidebar {
      margin: 0;
      padding: 0;
      width: 300px;
      background-color: #f6f6f6;
      position: fixed;
      height: 100%;
      overflow: auto;
      border: 1px solid #BDBDBD;
    }

    .outer-content {
      margin-left: 300px;
    }

    .inner-content {
      padding: 10px 40px;
    }

    p {
      display: inline;
    }

    .attribute-name {
      padding: 10px 20px 10px 20px;
      margin: 10px 0 20px 0;
      background-color: #ececec;
    }

    .attribute-definition {
      margin: 0 0 20px 0;
    }

    .category-container {
      padding-bottom: 20px;
    }

    .attribute-container {
      padding-bottom: 20px;
    }

    .value-table {
      margin: 0 0 30px 0;
      width: 50%;
    }

    table,
    td,
    th {
      border: 1px solid #ececec;
      border-collapse: collapse;
    }

    th {
      font-weight: bold;
    }

    td:hover {
      background-color: #ececec;
    }

    ul.links {
      margin-top: 5px;
    }

    hr.solid {
      border-top: 3px solid #f6f6f6;
    }

    .header {
      background-color: #f6f6f6;
      padding: 10px 20px 10px 40px;
      width: 100%;
      position: sticky;
      top: 0;
      border-top: 1px solid #BDBDBD;
      border-bottom: 1px solid #BDBDBD;
    }

    .categories {
      padding: 10px;
    }

    .category {
      padding-left: 10px;
      padding-right: 10px;
      padding-top: 5px;
      padding-bottom: 5px;
    }

    .subcategory {
      padding-left: 10px;
    }

    .subcategory-header {
      font-weight: normal;
    }

    .active {
      font-weight: bold;
      text-decoration: underline;
    }

    .element {
      font-weight: normal;
    }
  </style>
</head>

<body>
  <div class="sidebar">
    <div class="categories">
      <div class="category">
        <h4 id="loading-sidebar"><a href="#loading">Loading</a></h4>
        <div class="subcategory">
          <h5 class="subcategory-header" id="loading-attributes-sidebar"><a href="#loading-attributes">Attributes</a>
          </h5>
          <div class="element" id="loading-attributes-src">
            src
          </div>
          <div class="element" id="loading-attributes-alt">
            alt
          </div>
          <div class="element" id="loading-attributes-elmo">
            elmo
          </div>
          <h5 class="subcategory-header">Methods</h5>
        </div>
      </div>
      <div class="category">
        <h4><a href="#animation">Animation</a></h4>
        <div class="subcategory">
          <h5 class="subcategory-header"><a href="#animation-attributes">Attributes</a></h5>
          <h5 class="subcategory-header">Methods</h5>
        </div>
      </div>
    </div>
  </div>

  <!-- Start of all documentation -->
  <div class="outer-content">
    <div id="loading-docs"></div>
    <div id="animation-docs"></div>
  </div>

  <script>

    function loadJSON(filePath, callback) {
      var xobj = new XMLHttpRequest();
      xobj.overrideMimeType("application/json");
      xobj.open('GET', filePath, true); // Replace 'my_data' with the path to your file
      xobj.onreadystatechange = function () {
        if (xobj.readyState == 4 && xobj.status == "200") {
          // Required use of an anonymous callback as .open will NOT return a value but simply returns undefined in asynchronous mode
          callback(xobj.responseText);
        }
      };
      xobj.send(null);
    }

    function addHeader(header) {
      var para = document.createElement("div");
      para.classList.add('header');
      var node = document.createElement("H1");
      node.id = header.toLowerCase();
      node.innerText = header;
      para.appendChild(node);
      var element = document.getElementById("loading-docs");
      element.appendChild(para);
    }

    function convertJSONToHTML(json) {
      var obj = json[0];
      for (var key in obj) {
        if (key === 'Title') {
          addHeader(obj[key]);
        }
        console.log(key, obj[key])
      }
    }

    function init() {
      loadJSON('./data/loading.json', function (response) {
        // Parse JSON string into object
        var actual_JSON = JSON.parse(response);
        convertJSONToHTML(actual_JSON)
      });
    }

    init()
  </script>

  <script>
    async function fetchHtmlAsText(url) {
      const response = await fetch(url);
      return await response.text();
    }

    async function load() {
      // const contentDivLoading = document.getElementById("loading-docs");
      // contentDivLoading.innerHTML = await fetchHtmlAsText("./docs/loading-docs.html");

      // const contentDivAnimation = document.getElementById("animation-docs");
      // contentDivAnimation.innerHTML = await fetchHtmlAsText("./docs/animation-docs.html");
    }

    var globalCurrentView = [];
    var previouslyActive = '';
    var toRemove = '';
    var globalOrdering = [];

    function updateSidebar(sidebarName, sidebarSubcategory, sidebarCategory, option) {
      if (option === 'add') {
        document.querySelector(`div[id=${sidebarName}]`).classList.add('active');
        document.querySelector(`h5[id=${sidebarSubcategory}]`).classList.add('active');
        document.querySelector(`h4[id=${sidebarCategory}]`).classList.add('active');
      } else {
        document.querySelector(`div[id=${sidebarName}]`).classList.remove('active');
        document.querySelector(`h5[id=${sidebarSubcategory}]`).classList.remove('active');
        document.querySelector(`h4[id=${sidebarCategory}]`).classList.remove('active');
      }
    };

    function getSideBarIds(startName, isId) {
      const sb = "sidebar";
      if (isId) {
        var sidebarName = startName.split("-").slice(1, 10).join('-');
        var sidebarSub = startName.split("-").slice(1, 3);
        var sidebarCat = startName.split("-").slice(1, 2);
      } else {
        var sidebarName = startName;
        var sidebarSub = sidebarName.split("-").slice(0, 2);
        var sidebarCat = sidebarName.split("-").slice(0, 1);
      }
      sidebarSub.push(sb);
      const sidebarSubcategory = sidebarSub.join('-');
      sidebarCat.push(sb);
      const sidebarCategory = sidebarCat.join('-');
      return [sidebarName, sidebarSubcategory, sidebarCategory];
    }

    async function startUp() {

      await load();

      // observer needs to wait for loaded divs
      const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          var id = entry.target.getAttribute('id');
          var [sidebarName, sidebarSubcategory, sidebarCategory] = getSideBarIds(id, true);

          if (entry.intersectionRatio > 0) {
            // if you are within a long section so the header left view
            if (toRemove.length > 0) {
              var [newSidebarName, newSidebarSubcategory, newSidebarCategory] = getSideBarIds(previouslyActive, false);
              updateSidebar(newSidebarName, newSidebarSubcategory, newSidebarCategory, 'remove');
              updateSidebar(sidebarName, sidebarSubcategory, sidebarCategory, 'add');
              toRemove = '';
            }

            // if there isn't anything in globalCurrentView
            else if (globalCurrentView.length === 0) {
              updateSidebar(sidebarName, sidebarSubcategory, sidebarCategory, 'add');
              previouslyActive = sidebarName;
              globalCurrentView.push(sidebarName);

              // sidebarName index lesser means it appears above the currently active view
            } else if (globalOrdering.indexOf(previouslyActive) > globalOrdering.indexOf(sidebarName)) {
              var newSidebarName = globalCurrentView[0]
              var [newSidebarName, newSidebarSubcategory, newSidebarCategory] = getSideBarIds(newSidebarName, false);

              updateSidebar(newSidebarName, newSidebarSubcategory, newSidebarCategory, 'remove');
              updateSidebar(sidebarName, sidebarSubcategory, sidebarCategory, 'add');

              globalCurrentView.unshift(sidebarName);
              previouslyActive = sidebarName;

            } else {
              globalCurrentView.push(sidebarName);
            }
            // this is saying that the intersection was updated and its now out of view, but still within a property
          } else if (globalCurrentView.length === 1) {
            toRemove = previouslyActive;
            // this is saying that the intersection was updated and its now out of view
          } else {
            // if the thing being removed from view was currently active
            if (previouslyActive === sidebarName) {
              updateSidebar(sidebarName, sidebarSubcategory, sidebarCategory, 'remove');
              if (globalCurrentView.length >= 2) {
                newSidebarName = globalCurrentView[1];
                [newSidebarName, newSidebarSubcategory, newSidebarCategory] = getSideBarIds(newSidebarName, false);
                updateSidebar(newSidebarName, newSidebarSubcategory, newSidebarCategory, 'add');
                previouslyActive = newSidebarName;
              }
            }
            globalCurrentView = globalCurrentView.filter(e => e !== sidebarName);
          }
        });
      });

      document.querySelectorAll('div[id*="docs"]').forEach((section) => {
        // Only track attributes and properties, etc.
        if (section.getAttribute('id').split('-').length === 4) {
          globalOrdering.push(section.getAttribute('id').split("-").slice(1, 10).join('-'));
          observer.observe(section);
        }
      });
    };

    startUp();

    window.onscroll = function () { stickyHeader() };

    function stickyHeader() {
      var headers = document.getElementsByClassName("header");
      for (var i = 0; i < headers.length; i++) {
        var header = headers[i];
        var sticky = header.offsetTop;
        if (window.pageYOffset > sticky) {
          header.classList.add("sticky");
        } else {
          header.classList.remove("sticky");
        }
      }
    }

  </script>

  <!-- Documentation-specific dependencies: -->
  <script type="module" src="./built/dependencies.js">
  </script>
  <script nomodule src="./built/dependencies-legacy.js">
  </script>

  <!-- Loads <model-viewer> only on modern browsers: -->
  <script type="module" src="../node_modules/@google/model-viewer/dist/model-viewer.js">
  </script>

  <!-- Loads <model-viewer> only on old browsers like IE11: -->
  <script nomodule src="../node_modules/@google/model-viewer/dist/model-viewer-legacy.js">
  </script>
</body>

</html>