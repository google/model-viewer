<!--
/* @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <title>&lt;model-viewer&gt; Examples and Documentation</title>
  <meta charset="utf-8">
  <meta name="description" content="&lt;model-viewer&gt; examples and documentation">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link type="text/css" href="../styles/examples.css" rel="stylesheet" />
  <link rel="shortcut icon" type="image/png" href="../assets/favicon.png" />
  <script src="../node_modules/resize-observer-polyfill/dist/ResizeObserver.js"></script>

  <!-- The following libraries and polyfills are recommended to maximize browser support -->

  <!-- ðŸš¨ REQUIRED: Web Components polyfill to support Edge and Firefox < 63 -->
  <script src="../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>

  <!-- ðŸ’ OPTIONAL: Intersection Observer polyfill for better performance in Safari and IE11 -->
  <script src="../node_modules/intersection-observer/intersection-observer.js"></script>

  <!-- ðŸ’ OPTIONAL: Resize Observer polyfill improves resize behavior in non-Chrome browsers -->
  <script src="../node_modules/resize-observer-polyfill/dist/ResizeObserver.js"></script>

  <!-- ðŸ’ OPTIONAL: The :focus-visible polyfill removes the focus ring for some input types -->
  <script src="../node_modules/focus-visible/dist/focus-visible.js" defer></script>

  <style>
    html {
      scroll-behavior: smooth;
    }

    .sidebar {
      margin: 0;
      padding: 0;
      width: 300px;
      background-color: #f6f6f6;
      position: fixed;
      height: 100%;
      overflow: auto;
      border: 1px solid #BDBDBD;
    }

    .outer-content {
      margin-left: 300px;
    }

    .inner-content {
      padding: 10px 40px;
    }

    p {
      display: inline;
    }

    .attribute-name,
    .cssPropertie-name,
    .propertie-name,
    .method-name,
    .event-name,
    .slot-name {
      padding: 10px 20px 10px 20px;
      margin: 10px 0 20px 0;
      background-color: #ececec;
    }

    .attribute-definition,
    .cssPropertie-definition,
    .propertie-definition,
    .method-definition,
    .event-definition,
    .slot-definition {
      margin: 0 0 20px 0;
    }

    .category-container {
      padding-bottom: 20px;
    }

    .attribute-container,
    .cssPropertie-container,
    .propertie-container,
    .method-container,
    .event-container,
    .slot-container {
      padding-bottom: 20px;
    }

    .value-table {
      margin: 0 0 30px 0;
      width: 50%;
    }

    table,
    td,
    th {
      border: 1px solid #ececec;
      border-collapse: collapse;
    }

    th {
      font-weight: bold;
    }

    td:hover {
      background-color: #ececec;
    }

    ul.links {
      margin-top: 5px;
    }

    hr.solid {
      border-top: 3px solid #f6f6f6;
    }

    .header {
      background-color: #f6f6f6;
      padding: 10px 20px 10px 40px;
      width: 100%;
      position: sticky;
      top: 0;
      border-top: 1px solid #BDBDBD;
      border-bottom: 1px solid #BDBDBD;
    }

    .categories {
      padding: 10px;
    }

    .category {
      padding-left: 10px;
      padding-right: 10px;
      padding-top: 5px;
      padding-bottom: 5px;
    }

    .subcategory {
      padding-left: 10px;
    }

    .subcategory-header {
      font-weight: normal;
    }

    .active {
      font-weight: bold;
      text-decoration: underline;
      visibility: visible;
    }

    .de-active {
      font-weight: normal;
      text-decoration: none;
      display: none;
    }

    .element {
      font-weight: normal;
    }
  </style>
</head>

<body>
  <div class="sidebar">
    <div class="categories" id="sidebar-category-container">
    </div>
  </div>

  <!-- Start of all documentation -->
  <div class="outer-content">
    <div id="loading-docs"></div>
    <div id="animation-docs"></div>
  </div>

  <script>
    // CSS Custom Properties --> cssProperties
    function makeSidebar(category) {
      var container = document.getElementById('sidebar-category-container');
      var titleLower = category.Title.toLowerCase();

      var categoryDiv = document.createElement("div");
      categoryDiv.classList.add("category");

      var categoryHeader = document.createElement("H4");
      categoryHeader.id = titleLower.concat("-sidebar");

      var categoryLink = document.createElement("a");
      categoryLink.setAttribute("href", "#".concat(titleLower))
      categoryLink.innerText = category.Title;

      categoryHeader.appendChild(categoryLink);
      categoryDiv.append(categoryHeader);

      for (key in category) {
        if (key !== "Title") {
          var subCategory = document.createElement("div");
          subCategory.classList.add("subCategory");

          var subCategoryLink = document.createElement("a");
          if (key === "CSS Custom Properties") {
            var keyLower = "cssProperties";
          } else {
            var keyLower = key.toLowerCase();
          }

          var subCategoryHeader = document.createElement("H5");
          subCategoryHeader.id = titleLower.concat("-", keyLower, "-sidebar");
          subCategoryHeader.classList.add("subcategory-header");

          subCategoryLink.setAttribute("href", "#".concat(titleLower, "-", keyLower))
          subCategoryLink.innerText = key;

          subCategoryHeader.appendChild(subCategoryLink);
          subCategory.append(subCategoryHeader);

          category[key].forEach(function (element) {
            var ele = document.createElement("div");
            ele.classList.add("element");
            ele.classList.add("de-active");
            ele.id = titleLower.concat("-", keyLower, "-", element.htmlName);
            ele.innerText = element.name;
            subCategory.append(ele);
          });
          categoryDiv.appendChild(subCategory);
        }
      }
      container.appendChild(categoryDiv);
    }

    function loadJSON(filePath, callback) {
      var xobj = new XMLHttpRequest();
      xobj.overrideMimeType("application/json");
      xobj.open('GET', filePath, true); // Replace 'my_data' with the path to your file
      xobj.onreadystatechange = function () {
        if (xobj.readyState == 4 && xobj.status == "200") {
          // Required use of an anonymous callback as .open will NOT return a value but simply returns undefined in asynchronous mode
          callback(xobj.responseText);
        }
      };
      xobj.send(null);
    }

    function addHeader(header) {
      var lowerHeader = header.toLowerCase();

      var para = document.createElement("div");
      para.classList.add('header');
      var node = document.createElement("H1");
      node.id = lowerHeader;
      node.innerText = header;
      para.appendChild(node);
      var element = document.getElementById(lowerHeader.concat("-docs"));
      element.appendChild(para);
    }

    // {name:src      //loading   //attribute
    function makeElement(attribute, lowerHeader, pluralCategoryLower, categoryLower) {
      var attributeContainer = document.createElement("div");
      attributeContainer.classList.add(categoryLower.concat('-container'));

      // Creating the header
      var headerContainer = document.createElement("div");
      headerContainer.classList.add(categoryLower.concat('-name'));
      headerContainer.id = ['docs', lowerHeader, pluralCategoryLower, attribute.htmlName].join('-');

      var header = document.createElement("H4");
      header.innerText = attribute.name;

      headerContainer.appendChild(header);
      attributeContainer.appendChild(headerContainer);

      // Creating the description 
      var descriptionContainer = document.createElement("div");
      descriptionContainer.classList.add(categoryLower.concat('-definition'));

      var description = document.createElement("p");
      description.innerHTML = attribute.description;

      descriptionContainer.appendChild(description);
      attributeContainer.appendChild(descriptionContainer);

      if ('default' in attribute) {
        if (categoryLower === 'attribute' || categoryLower == "cssPropertie") {
          var table = document.createElement("TABLE");
          table.classList.add("value-table");

          var tr1 = document.createElement("TR");
          var th1 = document.createElement("TH");
          th1.innerText = "Default value";
          var th2 = document.createElement("TH");
          th2.innerText = "Type";
          var th3 = document.createElement("TH");
          th3.innerText = "Options";
          tr1.appendChild(th1);
          tr1.appendChild(th2);
          tr1.appendChild(th3);
          table.appendChild(tr1);

          var tr2 = document.createElement("TR");
          var td1 = document.createElement("TD");
          td1.innerText = attribute.default[0];
          var td2 = document.createElement("TD");
          td2.innerText = attribute.default[1];
          var td3 = document.createElement("TD");
          td3.innerText = attribute.default[2];
          tr2.appendChild(td1);
          tr2.appendChild(td2);
          tr2.appendChild(td3);
          table.appendChild(tr2);

          attributeContainer.appendChild(table);
        }
      }

      // Creating the links for an attribute
      if ('links' in attribute) {
        var linksContainer = document.createElement("div");

        var header = document.createElement("H4");
        header.innerText = "Relevant Links";

        var ul = document.createElement("UL");
        ul.classList.add("links");

        attribute.links.forEach(function (link) {
          var li = document.createElement("LI");
          li.innerHTML = link;
          ul.appendChild(li);
        });
        attributeContainer.appendChild(ul);
      }

      return attributeContainer;
    }

    function addAttributes(attributeArray, header, category, categoryLower) {
      var lowerHeader = header.toLowerCase();

      var element = document.getElementById(lowerHeader.concat("-docs"));

      var outer = document.createElement("div");
      outer.classList.add(categoryLower.concat('-container'));

      var middle = document.createElement("div");
      middle.classList.add("inner-content");

      var container = document.createElement("div");
      container.id = "docs-".concat(lowerHeader, "-", categoryLower);

      var headerNode = document.createElement("H3");
      headerNode.id = lowerHeader.concat("-", categoryLower);
      headerNode.innerText = category;

      outer.appendChild(middle);
      middle.appendChild(container);
      container.appendChild(headerNode);
      element.appendChild(outer);

      attributeArray.forEach(function (attribute) {
        var attr = makeElement(attribute, lowerHeader, categoryLower, categoryLower.slice(0, -1));
        container.appendChild(attr);
      });
    }

    function convertJSONToHTML(json) {
      var obj = json;
      var header = '';
      obj.forEach(function (category) {
        // Make body content
        for (var key in category) {
          if (key === 'Title') {
            header = category[key];
            addHeader(category[key]);
          } else if (key !== "Title") {
            if (key === "CSS Custom Properties") {
              var keyLower = "cssProperties";
            } else {
              var keyLower = key.toLowerCase();
            }
            addAttributes(category[key], header, key, keyLower);
          }
        }
        makeSidebar(category);
      });
    }

    var globalCurrentView = [];
    var previouslyActive = '';
    var toRemove = '';
    var globalOrdering = [];

    function updateSidebar(sidebarName, sidebarSubcategory, sidebarCategory, option) {
      if (option === 'add') {
        document.querySelector(`div[id=${sidebarName}]`).classList.add('active');
        document.querySelector(`h5[id=${sidebarSubcategory}]`).classList.add('active');
        document.querySelector(`h4[id=${sidebarCategory}]`).classList.add('active');
      } else {
        document.querySelector(`div[id=${sidebarName}]`).classList.remove('active');
        document.querySelector(`h5[id=${sidebarSubcategory}]`).classList.remove('active');
        document.querySelector(`h4[id=${sidebarCategory}]`).classList.remove('active');
      }
    };

    function addDeactive(sidebarName) {
      document.querySelector(`div[id=${sidebarName}]`).classList.add('de-active');
    }

    function removeDeactive (sidebarName) {
      document.querySelector(`div[id=${sidebarName}]`).classList.remove('de-active');
    }

    function getSideBarIds(startName, isId) {
      const sb = "sidebar";
      if (isId) {
        var sidebarName = startName.split("-").slice(1, 10).join('-');
        var sidebarSub = startName.split("-").slice(1, 3);
        var sidebarCat = startName.split("-").slice(1, 2);
      } else {
        var sidebarName = startName;
        var sidebarSub = sidebarName.split("-").slice(0, 2);
        var sidebarCat = sidebarName.split("-").slice(0, 1);
      }
      sidebarSub.push(sb);
      const sidebarSubcategory = sidebarSub.join('-');
      sidebarCat.push(sb);
      const sidebarCategory = sidebarCat.join('-');
      return [sidebarName, sidebarSubcategory, sidebarCategory];
    }


    var firstOpen = true;
    var everyEntry = [];

    function updateSidebarView(previouslyActive, prevSidebarSubcategory, sidebarName, sidebarSubcategory) {
      if (prevSidebarSubcategory !== sidebarSubcategory) {
        everyEntry.forEach(entry => {
          var id = entry.target.getAttribute('id');
          var [newSidebarName, newSidebarSubcategory, newSidebarCategory] = getSideBarIds(id, true);
          if (newSidebarSubcategory !== sidebarSubcategory) {
            addDeactive(newSidebarName);
          } else {
            removeDeactive(newSidebarName);
          }
        });
      }
    }

    function startUp() {

      // observer needs to wait for loaded divs
      const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          var id = entry.target.getAttribute('id');
          var [sidebarName, sidebarSubcategory, sidebarCategory] = getSideBarIds(id, true);

          if (entry.intersectionRatio > 0) {
            // if you are within a long section so the header left view
            if (toRemove.length > 0) {
              var [newSidebarName, newSidebarSubcategory, newSidebarCategory] = getSideBarIds(previouslyActive, false);
              updateSidebar(newSidebarName, newSidebarSubcategory, newSidebarCategory, 'remove');
              updateSidebar(sidebarName, sidebarSubcategory, sidebarCategory, 'add');
              updateSidebarView(previouslyActive, newSidebarSubcategory, sidebarName, sidebarSubcategory);
              toRemove = '';
            }

            // if there isn't anything in globalCurrentView
            else if (globalCurrentView.length === 0) {
              updateSidebar(sidebarName, sidebarSubcategory, sidebarCategory, 'add');
              previouslyActive = sidebarName;
              globalCurrentView.push(sidebarName);

              // sidebarName index lesser means it appears above the currently active view
            } else if (globalOrdering.indexOf(previouslyActive) > globalOrdering.indexOf(sidebarName)) {
              var newSidebarName = globalCurrentView[0]
              var [newSidebarName, newSidebarSubcategory, newSidebarCategory] = getSideBarIds(newSidebarName, false);

              updateSidebar(newSidebarName, newSidebarSubcategory, newSidebarCategory, 'remove');
              updateSidebar(sidebarName, sidebarSubcategory, sidebarCategory, 'add');
              updateSidebarView(previouslyActive, newSidebarSubcategory, sidebarName, sidebarSubcategory);

              globalCurrentView.unshift(sidebarName);
              previouslyActive = sidebarName;

            } else {
              globalCurrentView.push(sidebarName);
            }
            // this is saying that the intersection was updated and its now out of view, but still within a property
          } else if (globalCurrentView.length === 1) {
            toRemove = previouslyActive;
            // this is saying that the intersection was updated and its now out of view
          } else {
            // if the thing being removed from view was currently active
            if (previouslyActive === sidebarName) {
              updateSidebar(sidebarName, sidebarSubcategory, sidebarCategory, 'remove');
              if (globalCurrentView.length >= 2) {
                newSidebarName = globalCurrentView[1];
                [newSidebarName, newSidebarSubcategory, newSidebarCategory] = getSideBarIds(newSidebarName, false);
                updateSidebar(newSidebarName, newSidebarSubcategory, newSidebarCategory, 'add');
                updateSidebarView(previouslyActive, sidebarSubcategory, sidebarName, newSidebarSubcategory);
                previouslyActive = newSidebarName;
              }
            }
            globalCurrentView = globalCurrentView.filter(e => e !== sidebarName);
          }
        });
        // on initialization hide all other categories
        if (firstOpen) {
          firstOpen = false;
          everyEntry = entries;
          var [sidebarName, sidebarSubcategory, sidebarCategory] = getSideBarIds(previouslyActive, false);
          entries.forEach(entry => {
            var id = entry.target.getAttribute('id');
            var [newSidebarName, newSidebarSubcategory, newSidebarCategory] = getSideBarIds(id, true);
            if (newSidebarSubcategory !== sidebarSubcategory) {
              addDeactive(newSidebarName);
            } else {
              removeDeactive(newSidebarName);
            }
          });
        }
      });

      document.querySelectorAll('div[id*="docs"]').forEach((section) => {
        // Only track attributes and properties, etc.
        if (section.getAttribute('id').split('-').length === 4) {
          globalOrdering.push(section.getAttribute('id').split("-").slice(1, 10).join('-'));
          observer.observe(section);
        }
      });
    };

    function init() {
      loadJSON('./data/loading.json', function (response) {
        // Parse JSON string into object
        var actual_JSON = JSON.parse(response);
        convertJSONToHTML(actual_JSON);
        startUp();
      });
    }

    init();

    window.onscroll = function () { stickyHeader() };

    function stickyHeader() {
      var headers = document.getElementsByClassName("header");
      for (var i = 0; i < headers.length; i++) {
        var header = headers[i];
        var sticky = header.offsetTop;
        if (window.pageYOffset > sticky) {
          header.classList.add("sticky");
        } else {
          header.classList.remove("sticky");
        }
      }
    }

  </script>

  <!-- Documentation-specific dependencies: -->
  <script type="module" src="./built/dependencies.js">
  </script>
  <script nomodule src="./built/dependencies-legacy.js">
  </script>

  <!-- Loads <model-viewer> only on modern browsers: -->
  <script type="module" src="../node_modules/@google/model-viewer/dist/model-viewer.js">
  </script>

  <!-- Loads <model-viewer> only on old browsers like IE11: -->
  <script nomodule src="../node_modules/@google/model-viewer/dist/model-viewer-legacy.js">
  </script>
</body>

</html>